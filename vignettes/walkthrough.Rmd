---
title: "Walkthrough"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{examples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(openwashdata)
```


```{r basic, eval=FALSE}
library(openwashdata)
init_data_pkg("faecalsludgekampala",
              path = "~/repositories/openwashdata/")

```

Let's assume we have created a dataset named `faecal-sludge-kampala` in a folder `~/repositories/openwashdata/`.
This will open up new instance of RStudio with a project called faecal-sludge-kampala located in the `openwashdata-dev` folder. Let's focus our attention to this new instance of RStudio and walk through the steps in `bootstrap/bootstrap_pkg.R`.

## 1. Adding Authors

Once we got a the package skeleton, let's use the `authors.csv` template file to conveniently add multiple authors.

>Note that setting at least one author (and maintainer) is mandatory for the build process because the openwashdata package does not make use of the default author concept.


```
first_name,last_name,email,role,orcid
"Lars", "SchÃ¶bitz", "lschoebitz@ethz.ch", "aut;cre","0000-0003-2196-5015"
"Matt", "Bannert", "bannert@kof.ethz.ch", "aut","0000-0001-7901-9254"

```

>Note the use of ";" to list Lars' multiple roles as he is author and maintainer of the package.

## 2. Create a Citation File

After we entered all author information to `bootstrap/authors.csv`, let's turn
to the `bootstrap/bootstrap.R` script of our package project `faecalsludgekampala` 
and execute 

```{r, eval=FALSE}
a <- use_authors_from_csv()
```

to create a CITATION file. 

CITATION files facilitate citation of the data package as they are shown in places such GitHub or Zenodo. For more information on citation files and further modification, check the cffr package: https://docs.ropensci.org/cffr/. 

Once the package is built, citation information will be accessible through the corresponding R function which will create BibTeX output.



## 3. Process Raw Data

Now let's process files with the actual data and store them to the `data` folder from where the dataset that get bundled into the package need to be. In our case we have a single spreadsheet file `sustainability.xls`^[This raw spreadsheet file ships with the openwashdata package. In case you want to reproduce this exact example, you can find the file using `system.file("sustainability.xls", package = "openwashdata")`]. So let's try to read this file into R and see how it behaves.

```{r, eval=FALSE}
library(readxl)
stn <- read_xls("data-raw/sustainability.xls")

```

```{r, echo=FALSE}
library(readxl)
library(stringr)
library(dplyr)
library(tidyr)
library(usethis)
stn <- read_xls(system.file("sustainability.xls",
                            package = "openwashdata"))
stn

```

As you can see the data does not behave well, yet. Somehow `readxl` does not recognize the semicolon `;` as a delimiter and therefore only sees a single column. While this is uncommon for Excel spreadsheet and more remeniscant of a common `.csv` issue, it should be an easy fix. 

```{r}
# extract names first because we can't assign them
# until the data.frame has 15 columns
nms <- unlist(str_split(names(stn),pattern = ";"))
nms <- tolower(nms)
nms <- gsub("_$","",nms)
# set temporary name to make handling easier
names(stn) <- "col1"
dtaset <- stn |>
  separate(col1,
           into = paste0("col",1:length(nms)),
           sep = ";")
names(dtaset) <- nms
```

Now, let's add reasonable data types to the columns we've just created.

```{r}
# set proper data types ####
faecalsludge <- dtaset |>
  mutate(across(c(fid), as.integer)) |>
  mutate(across(c(height, volume, longitude, latitude), as.numeric)) |>
  mutate(date = as.Date(date, format = "%d.%m.%Y")) |>
  mutate(date_1 = as.Date(date_1, format = "%d.%m.%Y"))
```

Finally, let's store our data to the folder `data/` where R packages store datasets that are part of the package. Datasets in `data/` will be baked into the package at build time. 

```{r,eval=FALSE}

```

## 4. Create a Data Description Skeleton

Let's use the dataset we've just created to create a a basic outline inlcuding the information we can automatically extract data, such as column names and data types. 

```{r, eval=FALSE}
use_dictionary()
```

This will create a `dictionary.csv` file in `bootstrap/`. Use a text editor to replace the `NA`s in the description column and  add a description description. 





## 5. Compose Data Description




## 6. Init Git Version Control 

Once a first version of all files is around, it's a good time to initialize a `git` repository^[Note that git is not part of R and a git client needs to be installed. For more information on git and git based workflows, see also https://rse-book.github.io/version-control.html.].

```{r,eval=FALSE}
init_git()
```




## 5. Check out Work


```{r, eval=FALSE}
library(faecalsludgekampala)
citation("faecalsludgekampala")

```








